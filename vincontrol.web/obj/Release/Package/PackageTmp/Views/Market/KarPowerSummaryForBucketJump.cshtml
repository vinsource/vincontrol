@using System.Web.Optimization
@using Vincontrol.Web.Handlers

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <title>KBB Bucket Jump</title>

    <link href="@Url.Content("~/Content/inventory.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/js/fancybox/jquery.fancybox-1.3.4.css")" rel="stylesheet" type="text/css" />
    <style type="text/css">
        body
        {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            overflow: auto;
            padding-top: 10px;
            padding-bottom: 30px;
            /*width: 700px;*/
            padding-left: 60px;
            margin: 0 auto;
            margin-top: 20px;
            background: #003399;
        }

        input[type="button"], input[type="sumbit"]
        {
            background: #3366cc !important;
            border: 0;
            color: White;
            padding: 3px 6px;
        }

            input[type="button"]:hover, input[type="sumbit"]:hover
            {
                background: #3366cc !important;
            }
    </style>
    <style type="text/css">
        .bj_notes_holder
        {
            width: 95%;
            margin: 5px auto;
        }

        .bj_notes_title
        {
            font-weight: bold;
            color: #444;
            font-size: 15px;
        }

        .bj_notes_value
        {
            height: 120px;
            border: 1px solid #000;
        }

        .bj_signature_holder
        {
            width: 95%;
            height: 50px;
            margin: 30px auto;
        }

        .bj_signature_left
        {
            width: 40%;
            float: left;
        }

        .bj_signature_right
        {
            width: 40%;
            float: right;
        }

        .bj_signature_borderbottom
        {
            font-weight: bold;
            color: #444;
            font-size: 15px;
            border-bottom: 2px solid #555;
            padding: 3px;
            height: 20px;
        }

        .bj_signature_date
        {
            font-weight: bold;
            color: #444;
            font-size: 15px;
        }

        .bj_signature_date
        {
            font-weight: bold;
            color: #444;
            font-size: 15px;
        }

        .bj_cpricing
        {
            margin-top: 10px;
            font-weight: bold;
            font-size: 35px;
            text-align: center;
        }

        .bj_option_adjustment_holder
        {
            width: 50%;
            margin: 0px auto;
            height: 700px;
        }

        .bj_oa_title
        {
            /*padding-left: 42px;*/
            font-weight: bold;
            float: left;
            width: 47%;
            text-align: right;
        }

        .bj_oa_items_list
        {
        }

        .bj_oa_items
        {
            clear: both;
            height: 22px;
        }

        .bj_oa_items_text
        {
            float: left;
            font-weight: bold;
            width: 47%;
            text-align: right;
            color: #444;
            font-size: 14px;
        }

        .bj_oa_items_value
        {
            /*float: right;
	    width: 40%;*/
            float: left;
            font-weight: bold;
            width: 47%;
            text-align: right;
            background-color: #CDCDCD;
            border: 1px solid #000;
            font-size: 15px;
            font-weight: bold;
            color: #333;
        }

        .bj_adjustment_holder
        {
            clear: both;
            width: 80%;
            margin: 0px auto;
        }

        .bj_adjustment_items
        {
            clear: both;
            height: 40px;
            margin-top: 7px;
        }

        .bj_adjustment_title
        {
            text-align: center;
            float: left;
            margin-left: 5px;
            width: 240px;
            font-weight: bold;
            font-size: 14px;
        }

        .bj_adjustment_input_white
        {
            padding: 3px;
            width: 120px;
            border: 1px solid #333;
            background-color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            float: left;
            margin-left: 5px;
        }

        .bj_adjustment_input_gray
        {
            padding: 3px;
            width: 120px;
            border: 1px solid #333;
            background-color: #CDCDCD;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            float: left;
            margin-left: 5px;
        }

        .bj_vh_holder
        {
        }

            .bj_vh_holder > div
            {
                margin-top: 5px;
                box-sizing: border-box;
                -moz-box-sizing: border-box; /* Firefox */
                width: 43%;
            }

        .bj_vh_left
        {
            float: left;
        }

        .bj_vh_right
        {
            float: right;
        }

        .bj_vh_title
        {
            font-size: 14px;
            font-weight: bold;
        }

        .bj_vh_info
        {
            height: 130px;
        }

        .bj_vh_info_img
        {
            width: 40%;
            float: left;
            padding: 3px 0px;
            border: 1px solid #000;
        }

            .bj_vh_info_img img
            {
                width: 100%;
            }

        .bj_vh_info_pm
        {
            width: 58%;
            float: right;
        }

        .bj_vh_info_price
        {
            text-align: center;
        }

        .bj_vh_info_title
        {
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .bj_vh_info_value
        {
            border: 2px solid #777;
            font-size: 20px;
            color: #FFF;
            background-color: #039;
            font-weight: bold;
        }

        .bj_vh_info_mileage
        {
            text-align: center;
        }

            .bj_vh_info_mileage .bj_vh_info_value
            {
                font-size: 15px !important;
                padding: 3px;
            }

        .bucketjump_container
        {
            margin: 0px auto;
            width: auto;
            background-color: white;
            display: inline-block;
            /* border: 1px solid black; */
            padding: 2px;
        }

        .bucketjump_vinlogo img
        {
            margin: 10px auto;
            display: block;
        }

        .bucketjump_age_holder
        {
            width: 42%;
            height: 30px;
            margin: 0px auto;
        }

        .bucketjump_age_items
        {
            float: left;
            border: 1px solid #333;
            font-size: 14px;
            width: 23px;
            text-align: center;
            padding: 5px;
            font-weight: bold;
        }

        .bucketjump_age_title, .bucketjump_age_chosen
        {
            background-color: #CDCDCD;
        }

        .bucketjump_dealer_compare_holder
        {
            clear: both;
            border: 2px solid #333;
            height: 28px;
            margin-top: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

            .bucketjump_dealer_compare_holder > div
            {
                box-sizing: border-box;
                -moz-box-sizing: border-box; /* Firefox */
                float: left;
                text-align: center;
                padding: 5px;
                font-size: 15px;
                font-weight: bold;
            }

        .bj_dc_left
        {
            width: 43%;
        }

        .bj_dc_middle
        {
            background-color: #039;
            color: white;
            width: 14%;
            border-left: 2px solid #777;
            border-right: 2px solid #777;
        }

        .bj_dc_right
        {
            width: 43%;
        }

        #vehicle-list table
        {
            width: 980px;
            font-size: 1.0em;
        }

        #vehicle-list td
        {
            padding: .3em .7em .3em .7em;
            border-bottom: 1px #bbbbbb solid;
        }

        #vehicle-list tr:nth-child(2n+2) td
        {
            background: #cccccc;
        }

        #vehicle-list tr.highlight td
        {
            background: green;
            color: #fff;
        }
        /*#vehicle-list tr:nth-child(1) td {font-weight: bold;color: white;background: #222222;}*/
        .isTargetCar
        {
            background-color: Green;
        }

        #graph-title-bar
        {
            position: relative;
            height: 50px !important;
            max-height: 50px !important;
            overflow: hidden;
            width: 99%;
            display: block;
        }

            #graph-title-bar h2
            {
                display: inline-block;
                padding-bottom: 0;
                margin-bottom: 0;
            }

            #graph-title-bar a
            {
                margin-left: 20px;
                padding: .2em .5em .2em .5em;
                background: #c80000;
                color: white;
                position: relative;
                top: -3px;
                font-size: .9em;
                cursor: pointer;
            }

                #graph-title-bar a:hover
                {
                    background: #880000;
                }

        #printable-list
        {
            display: block;
        }

        .contain_list
        {
            background-color: #E8EAEF;
            display: table;
            width: 100%;
        }

        .list_odd
        {
            background-color: white;
        }

        .white
        {
            border: 2px solid white;
            /*width: 150px!important;*/
        }
    </style>
</head>
<body>
    <div id="divEnterMilage" style="margin-left:0px;">
    <div>
        <input type="hidden" id="txtListingId" name="txtListingId" value="@((String)ViewData["LISTINGID"])" />
        <input type="hidden" id="txtSelectedVin" name="txtSelectedVin" value="@((String)ViewData["SelectedVin"])" />
        <input type="hidden" id="txtVin" name="txtVin" value="@((String)ViewData["VIN"])" />
        <input type="hidden" id="txtMileage" name="txtMileage" value="@((String)ViewData["MILEAGE"])" />
        <input type="hidden" id="txtDealer" name="txtDealer" value="@((String)ViewData["DEALER"])" />
        <input type="hidden" id="txtPrice" name="txtPrice" value="@((String)ViewData["PRICE"])" />
        <input type="hidden" id="txtYear" name="txtYear" value="@((String)ViewData["YEAR"])" />
        <input type="hidden" id="txtMake" name="txtMake" value="@((String)ViewData["MAKE"])" />
        <input type="hidden" id="txtModel" name="txtModel" value="@((String)ViewData["MODEL"])" />
        <input type="hidden" id="txtColor" name="txtColor" value="@((String)ViewData["COLOR"])" />
        <input type="hidden" id="txtImage" name="txtImage" value="@((String)ViewData["IMAGE"])" />

        <input type="hidden" id="hdChartCarType" name="hdChartCarType" value="@(ViewData["ChartCarType"])" />
        <input type="hidden" id="hdTrims" name="hdTrims" value="@((String)ViewData["Trims"])" />
        <input type="hidden" id="hdisAll" name="hdisAll" value="@(ViewData["isAll"].ToString())" />
        <input type="hidden" id="hdisFranchise" name="hdisFranchise" value="@(ViewData["isFranchise"].ToString())" />
        <input type="hidden" id="hdisIndependant" name="hdisIndependant" value="@(ViewData["isIndependant"].ToString())" />
        <input type="hidden" id="hdInventoryType" name="hdInventoryType" value="@(ViewData["inventoryType"])" />
        <input type="hidden" id="hdranges" name="hdranges" value="@(ViewData["ranges"])" />
        <input type="hidden" id="hdnIsMassBucketJump" name="hdnIsMassBucketJump" value="@(ViewData["IsMassBucketJump"].ToString())" />
        
                
    </div>
    <div id="content">
    <table border="0" cellpadding="2" cellspacing="2" width="750px" style="color:Black;background-color:White;">
            @if(SessionHandler.Dealer != null && SessionHandler.Dealer.IsPendragon){
                <tr>
                    <td>
                        <div>
                            <input type="radio" id="radioPlus5" name="radioPlus" value="5" />Plus 5%</div>
                        <div style="margin-left: 20px;">(0-10k)</div>
                    </td>
                    <td>
                        <div>
                            <input type="radio" id="radioPlus4" name="radioPlus" value="4" />Plus 4%</div>
                        <div style="margin-left: 20px;">(10k-21k)</div>
                    </td>
                    <td>
                        <div>
                            <input type="radio" id="radioPlus3" name="radioPlus" value="3" />Plus 3%</div>
                        <div style="margin-left: 20px;">(21k-30k)</div>
                    </td>
                    <td>
                        <div>
                            <input type="radio" id="radioPlus2" name="radioPlus" value="2" />Plus 2%</div>
                        <div style="margin-left: 20px;">(>31k)</div>
                    </td>
                    <td>
                        <div>
                            <input type="checkbox" id="chkCertified" name="chkCertified" />Certified</div>
                        <div>&nbsp;</div>
                    </td>
                </tr> 
            } else
            {
                <tr>
                    <td style="text-align: center;">
                        <div style="margin-left: 60px; float: left;">Independent Add</div>
                        <select id="ddlIndependentAdd" name="ddlIndependentAdd">
                            <option value="0">--- Select ---</option>
                            <option value="1">1%</option>
                            <option value="2">2%</option>
                            <option value="3">3%</option>
                            <option value="4">4%</option>
                            <option value="5">5%</option>
                        </select>
                    </td>
                    <td style="text-align: center;">
                        <div style="margin-left: 60px; float: left;">Certified Add</div>
                        <select id="ddlCertifiedAdd" name="ddlCertifiedAdd">
                            <option value="0">--- Select ---</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                            <option value="1500">1500</option>
                            <option value="2000">2000</option>
                            <option value="2500">2500</option>
                        </select>
                    </td>
                </tr>
            }            
            
        </table>
    <div id="result">
    </div>
    </div>
    </div>
    <div id="FailedAuthorization" style="display:none;font-size:18px;color:White;">This feature is available with a Karpower account. Please contact Vincontrol support for more detail.</div>

    <script src="@Url.Content("~/js/jquery-1.6.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/js/jquery.cookie.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/js/jquery.blockUI.js")" type="text/javascript"></script>    
    <script src="@Url.Content("~/js/fancybox/jquery.fancybox-1.3.4.pack.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/js/Utility.js")" type="text/javascript"></script>
    <script type="text/javascript">
        var warningMessage = "Please change Vin or Mileage, then click Get Value again!";
        var fileDownloadCheckTimer;
        var originalWholeSale = 0;
        var skip = true;
        var count = 1;
        function blockUIForDownload() {
            var token = new Date().getTime(); //use the current timestamp as the token value
            $('#DownloadTokenValueId').val(token);
            blockUIPopUp();
            fileDownloadCheckTimer = window.setInterval(function () {
                var cookieValue = $.cookie('fileDownloadToken');
                if (cookieValue == token)
                    finishDownload();
            }, 1000);
        }

        function finishDownload() {
            window.clearInterval(fileDownloadCheckTimer);
            $.cookie('fileDownloadToken', null); //clears this cookie value
            unblockUI();
        }

        $(document).ready(function () {

            blockUIPopUp();
            $.ajax({
                type: "GET",
                dataType: "html",
                url: '@Url.Action("HasKBBAuthorization", "Ajax")',
                data: {},
                cache: false,
                traditional: true,
                success: function (result) {
                    if (result == 'False') {
                        $('#FailedAuthorization').show();
                        $('#divEnterMilage').hide();
                        unblockUI();
                    } else {
                        unblockUI();
                        GetValuation($('#txtVin').val(), $('#txtMileage').val());
                    }
                },
                error: function (err) {
                    //jAlert("Incorrect KBB's Username/Password.", 'Warning');
                    $('#FailedAuthorization').show();
                    $('#divEnterMilage').hide();
                    unblockUI();
                }
            });

            $("#SelectedEngineId").live("change", function () {
                if ($("#SelectedTransmissionId").val() == 0) return false;

                blockUIPopUp();

                $.ajax({
                    type: "POST",
                    url: "/Market/UpdateValuationByChangingTrimAndTransmissionForBucketJump?trimId=" + $("#SelectedTrimId").val() + "&transmissionId=" + $("#SelectedTransmissionId").val() + "&engineId=" + $("#SelectedEngineId").val(),
                    data: {},
                    dataType: 'html',
                    success: function (data) {

                        $("#result").html(data);
                        unblockUI();
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        unblockUI();
                        console.log(xhr.status + ' ' + thrownError);
                    }
                });
            });

            $("#SelectedMakeId").live("change", function () {                
                return false;
            });

            $("#SelectedModelId").live("change", function () {
                if ($("#SelectedModelId").val() == 0) return false;

                blockUIPopUp();

                $.ajax({
                    type: "POST",
                    url: "/Market/UpdateValuationByChangingModelForBucketJump?modelId=" + $("#SelectedModelId").val(),
                    data: {},
                    dataType: 'html',
                    success: function (data) {

                        $("#result").html(data);
                        unblockUI();
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        unblockUI();
                        console.log(xhr.status + ' ' + thrownError);
                    }
                });
            });

            $("#SelectedTrimId").live("change", function () {
                if ($("#SelectedTrimId").val() == 0) return false;

                blockUIPopUp();

                $.ajax({
                    type: "POST",
                    url: "/Market/UpdateValuationByChangingTrimForBucketJump?trimId=" + $("#SelectedTrimId").val(),
                    data: {},
                    dataType: 'html',
                    success: function (data) {

                        $("#result").html(data);
                        unblockUI();
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        unblockUI();
                        console.log(xhr.status + ' ' + thrownError);
                    }
                });
            });

            $("#SelectedTransmissionId").live("change", function () {
                if ($("#SelectedTransmissionId").val() == 0) return false;

                blockUIPopUp();

                $.ajax({
                    type: "POST",
                    url: "/Market/UpdateValuationByChangingTrimAndTransmissionForBucketJump?trimId=" + $("#SelectedTrimId").val() + "&transmissionId=" + $("#SelectedTransmissionId").val() + "&engineId=" + $("#SelectedEngineId").val(),
                    data: {},
                    dataType: 'html',
                    success: function (data) {

                        $("#result").html(data);
                        unblockUI();
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        unblockUI();
                        console.log(xhr.status + ' ' + thrownError);
                    }
                });
            });

            $("#SelectedDriveTrainId").live("change", function () {
                return false;
            });

            $('input[name^="option_"]').live("click", function () {
                var listingId = this.id.split('_')[1];
                var isChecked = $(this).is(":checked");
                //$.blockUI({ message: '<div><img src="../../images/ajaxloadingindicator.gif" /></div>', css: { width: '300px', backgroundColor: 'none', border: 'none'} });

                $.ajax({
                    type: "GET",
                    url: "/Market/UpdateValuationByOptionalEquipmentForBucketJump?listingId=" + listingId + "&isChecked=" + isChecked,
                    data: {},
                    dataType: 'html',
                    success: function (data) {

                        $("#result").html(data);
                        //unblockUI();
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        //unblockUI();
                        console.log(xhr.status + ' ' + thrownError);
                    }
                });
            });

            $('#btnPrint').live('click', function () {
                skip = true;
                Printing();

                //var isMassBucketJump = $('#hdnIsMassBucketJump').val();
                //if (isMassBucketJump == 'True') {
                //    blockUIPopUp();

                //    var selectedOptions = "";
                //    var plus = $("input:radio[name='radioPlus']:checked").val() == "" || $("input:radio[name='radioPlus']:checked").val() == undefined ? "0" : $("input:radio[name='radioPlus']:checked").val();

                //    var wholesaleWithoutOptions = originalWholeSale;
                    
                //    var wholesaleWithOptions = $('#txtBaseWholesale').html();
                //    if (wholesaleWithOptions == undefined) {
                //        wholesaleWithOptions = $('#hidWholeSaleOptions').val();
                //    }
                   
                //    $("input:checkbox[name^=option_]:checked").each(function () {                        
                //        selectedOptions += $(this).val() + ", ";
                //    });
                    
                //    $.ajax({
                //        type: "POST",
                //        url: "/Market/KarPowerResultForMassBucketJump",
                //        data: {
                //            listingId: $('#txtListingId').val(),
                //            dealer: $('#txtDealer').val(),
                //            price: $('#txtPrice').val(),
                //            year: $('#txtYear').val(),
                //            make: $('#txtMake').val(),
                //            model: $('#txtModel').val(),
                //            color: $('#txtColor').val(),
                //            miles: $('#txtMileage').val(),
                //            plusPrice: plus,
                //            certified: $("#chkCertified").is(":checked"),
                //            independentAdd: ($("#ddlIndependentAdd option:selected").val()),
                //            certifiedAdd: ($("#ddlCertifiedAdd option:selected").val()),
                //            wholesaleWithoutOptions: wholesaleWithoutOptions,
                //            wholesaleWithOptions: wholesaleWithOptions,
                //            options: selectedOptions,
                //            chartCarType: ($('#hdChartCarType').val() == '' || $('#hdChartCarType').val() == null ? 0 : parseInt($('#hdChartCarType').val())),
                //            trims: $('#hdTrims').val(),
                //            isAll: $('#hdisAll').val(),
                //            isFranchise: $('#hdisFranchise').val(),
                //            isIndependant: $('#hdisIndependant').val(),
                //            inventoryType: $('#hdInventoryType').val(),
                //            ranges: $('#hdranges').val(),
                //            selectedVin: $('#txtSelectedVin').val(),
                //            image: $('#txtImage').val(),
                            
                //        },
                //        dataType: 'html',
                //        success: function (data) {
                //            $('#content').html(data);
                //            unblockUI();
                //        },
                //        error: function (xhr, ajaxOptions, thrownError) {
                //            unblockUI();
                //        }
                //    });
                //} else {
                //    skip = true;
                //    Printing();
                //}
            });

            $('#btnSkip').live('click', function () {
                skip = true;
                Printing();
            });

            $('#btnApplyAll').live('click', function () {
                skip = false;
                Printing();
            });

            $('#IsMassBucketJumpAll').live('click', function () {
                if ($(this).is(":checked")) {
                    //$("inpuyt:checkbox[id^=IsMassBucketJump_]").prop({ checked: true });
                    $("input:checkbox[name^=IsMassBucketJump_]").each(function () {
                        $(this).prop("checked", true);
                    });
                } else {
                    //$("inpuyt:checkbox[id^=IsMassBucketJump_]").prop("checked", false);
                    $("input:checkbox[name^=IsMassBucketJump_]").each(function () {
                        $(this).prop("checked", false);
                    });
                }
            });

            $('#IsCertified').live('click', function () {
                if ($(this).is(":checked")) {                    
                    $("div.nocertified").each(function () {
                        $(this).hide();
                    });
                } else {
                    $("div.nocertified").each(function () {
                        $(this).show();
                    });
                }
            });
        });

        function Printing() {
            count = 1;
            var selectedOptions = "";
            $("input:checkbox[name^=option_]:checked").each(function () {
                if (selectedOptions.length < 200)
                    selectedOptions += $(this).val() + ", ";
            });

            var selectedListingIds = $('#txtListingId').val() + ", ";
            $("input:checkbox[name^=IsMassBucketJump_]:checked").each(function () {
                selectedListingIds += $(this).val() + ",";
                count++;
            });

            var plus = $("input:radio[name='radioPlus']:checked").val() == "" || $("input:radio[name='radioPlus']:checked").val() == undefined ? "0" : $("input:radio[name='radioPlus']:checked").val();

           
            var wholesaleWithoutOptions = originalWholeSale;

            var wholesaleWithOptions = $('#txtBaseWholesale').html();

            if (wholesaleWithOptions == null ) {
                wholesaleWithOptions = $('#hidWholeSaleOptions').val();
            }
            
            var certified = $("#chkCertified").is(":checked");
            if ($('#hidCertified') != null && $('#hidCertified').val() != undefined) {
                certified = $('#hidCertified').val();
            }
       

            blockUIPopUp();
            var flag = true;
            var temp = window.setInterval(function () {
                if (flag) {
                    unblockUI();
                    //ShowInfoMessage("Bucket jump applied to all selected vehicles successfully.");
                    flag = false;
                }
            }, skip ? 10000 : 10000 * count);
            var url = "/PDF/PrintBucketJumpWithKarPowerOptions?listingId=" + (skip ? $('#txtListingId').val() : selectedListingIds);
            url += "&dealer=" + $('#txtDealer').val();
            url += "&price=" + $('#txtPrice').val();
            url += "&year=" + $('#txtYear').val();
            url += "&make=" + $('#txtMake').val();
            url += "&model=" + $('#txtModel').val();
            url += "&color=" + $('#txtColor').val();
            url += "&miles=" + $('#txtMileage').val();
            url += "&plusPrice=" + plus;
            url += "&certified=" + certified;
            url += "&independentAdd=" + ($("#ddlIndependentAdd option:selected").val());
            url += "&certifiedAdd=" + ($("#ddlCertifiedAdd option:selected").val());
            url += "&wholesaleWithoutOptions=" + wholesaleWithoutOptions;
            url += "&wholesaleWithOptions=" + wholesaleWithOptions;
            url += "&options=" + selectedOptions;
            url += "&chartCarType=" + ($('#hdChartCarType').val() == '' || $('#hdChartCarType').val() == null ? 0 : parseInt($('#hdChartCarType').val()));
            url += "&Trims=" + $('#hdTrims').val();
            url += "&isAll=" + $('#hdisAll').val();
            url += "&isFranchise=" + $('#hdisFranchise').val();
            url += "&isIndependant=" + $('#hdisIndependant').val();
            url += "&inventoryType=" + $('#hdInventoryType').val();
            url += "&ranges=" + $('#hdranges').val();
            url += "&selectedVin=" + $('#txtSelectedVin').val();
            url += "&image=" + $('#txtImage').val();
            url += "&marketId=" + 0;
            url += "&marketType=" + '';
            
            window.location.href = url;            
        }

        function GetValuation(vin, mileage) {
            blockUIPopUp();

            $.ajax({
                type: "POST",
                url: "/Market/KarPowerResultForBucketJump?vin=" + vin + "&mileage=" + mileage,
                data: {},
                dataType: 'html',
                success: function (data) {

                    $("#result").html(data);
                    originalWholeSale = $('#BaseWholesaleWithoutOptions').val();
                    
                    unblockUI();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    unblockUI();
                    console.log(xhr.status + ' ' + thrownError);
                }
            });
        }        
    </script>
</body>
</html>
